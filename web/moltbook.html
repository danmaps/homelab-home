<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moltbook summaries</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#101826; --text:#e9eef6; --muted:#a9b4c1;
      --border:#1f2a3a; --good:#34d399; --bad:#fb7185;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    body{ margin:0; background:var(--bg); color:var(--text); }
    header{ padding:16px; max-width:1100px; margin:0 auto; }
    h1{ margin:0; font-size:18px; }
    .sub{ color:var(--muted); font-size:13px; margin-top:6px; }
    main{ padding:12px 16px 48px; max-width:1100px; margin:0 auto; }
    .layout{ display:grid; grid-template-columns: 280px 1fr; gap:12px; }
    @media(max-width: 900px){ .layout{ grid-template-columns: 1fr; } }
    .card{ border:1px solid var(--border); background:var(--card); border-radius:14px; padding:12px; }
    a{ color:#7dd3fc; text-decoration:none; }
    a:hover{ text-decoration:underline; }
    .list{ display:flex; flex-direction:column; gap:6px; }
    .item{ padding:8px 10px; border:1px solid var(--border); border-radius:10px; cursor:pointer; background:rgba(255,255,255,0.02); }
    .item.active{ border-color:#7dd3fc55; }
    pre{ white-space:pre-wrap; word-break:break-word; margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12.5px; line-height:1.45; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button{ background:transparent; color:var(--text); border:1px solid var(--border); padding:8px 10px; border-radius:10px; cursor:pointer; }
    .muted{ color:var(--muted); }
  </style>
</head>
<body>
<header>
  <div class="row" style="justify-content:space-between;">
    <div>
      <h1>Moltbook summaries</h1>
      <div class="sub">Daily recap files from the private repo (served locally by homelab-home)</div>
    </div>
    <div class="row">
      <a href="/">Home</a>
      <button id="btnRefresh">Refresh</button>
    </div>
  </div>
</header>
<main>
  <div class="layout">
    <div class="card">
      <div class="muted" style="margin-bottom:10px;">Days</div>
      <div class="list" id="list"></div>
    </div>
    <div class="card">
      <div class="muted" id="hdr" style="margin-bottom:10px;">Select a day…</div>
      <pre id="content"></pre>
    </div>
  </div>
</main>

<script>
  const els = {
    list: document.getElementById('list'),
    content: document.getElementById('content'),
    hdr: document.getElementById('hdr'),
    btnRefresh: document.getElementById('btnRefresh'),
  };

  let current = '';

  function setActive(date){
    current = date;
    document.querySelectorAll('.item').forEach(el => {
      el.classList.toggle('active', el.getAttribute('data-date') === date);
    });
  }

  async function loadList(){
    const r = await fetch('/api/moltbook/summaries');
    const j = await r.json();
    const items = (j.items || []).slice().reverse();

    if(!items.length){
      els.list.innerHTML = '<div class="muted">No summaries found. Check config.local.json: moltbookSummaries.dir</div>';
      return;
    }

    els.list.innerHTML = items.map(it => `<div class="item" data-date="${it.date}">${it.date}</div>`).join('');

    document.querySelectorAll('.item').forEach(el => {
      el.addEventListener('click', async () => {
        const date = el.getAttribute('data-date');
        await loadDay(date);
      });
    });

    // auto-load newest
    if(!current){
      await loadDay(items[0].date);
    }
  }

  async function loadDay(date){
    setActive(date);
    els.hdr.textContent = `Loading ${date}…`;
    els.content.textContent = '';

    const r = await fetch(`/api/moltbook/summaries/${date}`);
    const j = await r.json();
    if(!j.success){
      els.hdr.textContent = `Failed to load ${date}`;
      els.content.textContent = j.error || 'error';
      return;
    }
    els.hdr.textContent = `Moltbook summary (${date})`;
    els.content.textContent = j.content || '';
  }

  els.btnRefresh.addEventListener('click', async () => {
    current = '';
    await loadList();
  });

  loadList();
</script>
</body>
</html>
